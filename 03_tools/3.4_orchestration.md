# 3.4 多工具编排与复杂流程

实际应用中，Claude 常常需要调用多个工具来完成一个任务。

---

## 多工具定义

```python
tools = [
    {
        "name": "search_flights",
        "description": "搜索航班信息",
        "input_schema": {...}
    },
    {
        "name": "search_hotels", 
        "description": "搜索酒店信息",
        "input_schema": {...}
    },
    {
        "name": "book_reservation",
        "description": "预订航班或酒店",
        "input_schema": {...}
    }
]
```

---

## 并行工具调用

Claude 可以在一次响应中请求多个工具：

```json
{
  "content": [
    {"type": "tool_use", "name": "search_flights", ...},
    {"type": "tool_use", "name": "search_hotels", ...}
  ]
}
```

你可以并行执行这些工具，然后一次性返回所有结果。

---

## 顺序调用

某些场景需要顺序执行：

```
用户：帮我订明天去上海的机票

Claude → search_flights（查询航班）
     ↓
你执行 → 返回航班列表
     ↓
Claude → 展示选项，询问用户选择
     ↓
用户：选第二个
     ↓
Claude → book_reservation（预订）
```

---

## 循环处理

```python
while True:
    response = client.messages.create(...)
    
    if response.stop_reason == "end_turn":
        # 任务完成
        break
    elif response.stop_reason == "tool_use":
        # 执行工具，继续循环
        tool_results = execute_tools(response)
        messages.append(...)
```

---

## 小结

- Claude 支持并行和顺序的多工具调用
- 使用循环处理复杂的多轮工具交互
- 合理设计工具粒度，避免过于复杂
