## 7.2 Claude Code CLI 入门

**Claude Code** 是 Anthropic 推出的专为开发者设计的终端工具。它不仅仅是一个 API 包装器，而是一个具有 **Agentic Capabilities** 的编程助手——可以直接读取文件系统、运行终端命令、甚至自动提交 Git commit。

### 7.2.1 安装与认证

#### 安装
通过 npm 安装：
```bash
npm install -g @anthropic-ai/claude-code
```

#### 认证
首次运行需要登录：
```bash
claude login
```
系统会弹窗引导完成 OAuth 授权，或提示输入 API Key。

### 7.2.2 核心命令

#### 交互模式
直接运行 `claude` 进入对话模式：

```bash
$ claude
> 帮我分析一下当前目录的结构。
(Claude runs `ls -R`)
当前目录包含 src, tests 和 docs...

> 把 src/utils.py 里的日志库从 logging 换成 structlog。
(Claude reads src/utils.py, edits, shows diff)
```

#### 单次任务
```bash
claude commit                    # 生成 commit message
claude "explain main.go"         # 解释代码
claude "fix strict null checks"  # 快速重构
```

### 7.2.3 CLAUDE.md：项目配置文件

`CLAUDE.md` 是 Claude Code 的核心配置机制，让 Claude 自动获取项目上下文。

#### 什么是 CLAUDE.md？

`CLAUDE.md` 是一个特殊的配置文件，Claude Code 会自动读取并将其内容注入到每次对话的系统提示中。这意味着你无需重复解释项目结构、编码规范和常用命令。

#### 文件位置

| 位置 | 作用域 | 优先级 |
| :--- | :--- | :--- |
| `~/.claude/CLAUDE.md` | 所有项目通用 | 最低 |
| 父目录的 `CLAUDE.md` | Monorepo 跨项目共享 | 中 |
| 项目根目录 `CLAUDE.md` | 当前项目 | 最高 |

#### 示例 CLAUDE.md

```markdown
# Project Context

When working with this codebase, prioritize readability over cleverness.

## About This Project
FastAPI REST API for user authentication. Uses SQLAlchemy and Pydantic.

## Key Directories
- `app/models/` - database models
- `app/api/` - route handlers
- `app/core/` - configuration and utilities

## Standards
- Type hints required on all functions
- pytest for testing (fixtures in `tests/conftest.py`)
- PEP 8 with 100 character lines

## Common Commands
```bash
uvicorn app.main:app --reload  # dev server
pytest tests/ -v               # run tests
```

## Notes
All routes use `/api/v1` prefix. JWT tokens expire after 24 hours.
```

#### 使用 /init 自动生成

运行 `/init` 命令可以自动分析项目并生成初始 `CLAUDE.md`：

```bash
cd your-project
claude
/init
```

Claude 会检查 package.json、README、配置文件等，生成一份针对你项目的配置文件。

### 7.2.4 自定义 Slash Commands

将常用的提示词封装为自定义命令，避免重复输入。

#### 创建自定义命令

在 `.claude/commands/` 目录下创建 Markdown 文件：

```bash
mkdir -p .claude/commands
```

创建 `.claude/commands/security-review.md`：

```markdown
# Security Review

Analyze the provided code for security vulnerabilities:

## Areas to Check
- SQL injection risks
- XSS vulnerabilities
- Authentication/authorization issues
- Sensitive data exposure
- Input validation

## Output Format
For each issue:
1. **Severity**: Critical/High/Medium/Low
2. **Location**: File and line number
3. **Issue**: Description
4. **Fix**: Recommended solution

**Code to review:**
$ARGUMENTS
```

#### 使用自定义命令

```bash
> /security-review src/auth/login.py
```

`$ARGUMENTS` 会被替换为命令后的参数。

### 7.2.5 上下文管理技巧

#### 使用 /clear 重置上下文

长时间对话会累积无关上下文。在切换任务时使用：

```bash
> /clear
```

这会清除对话历史，但保留 `CLAUDE.md` 配置。

#### 使用 Subagent 隔离上下文

对于需要不同视角的任务（如实现后的安全审查），指示 Claude 使用子代理：

```bash
> 使用一个子代理对刚才实现的代码进行安全审查
```

子代理拥有独立的上下文，不会被前序开发思路影响。

### 7.2.6 权限模式

为了安全，Claude Code 提供不同的权限级别：

| 模式 | 读取文件 | 写入文件 | 执行命令 |
| :--- | :---: | :---: | :---: |
| **Safe (默认)** | ✅ | 需确认 | 需确认 |
| **Auto (`--auto`)** | ✅ | ✅ | 安全命令自动执行 |

危险命令（如 `rm`）在任何模式下都需要确认。

---

CLI 工具非常适合个人开发者在本地终端使用。若想构建自动化的 CI/CD 机器人或 IDE 插件，则需要更底层的 SDK。

➡️ [Claude Code SDK 集成](7.3_sdk.md)
