## 7.3 Claude Code SDK é›†æˆ

å¦‚æœè¯´ Claude Code CLI åƒæ˜¯ä¸€æŠŠç‘å£«å†›åˆ€ï¼Œè®©å¼€å‘è€…åœ¨ç»ˆç«¯ä¸­å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œé‚£ä¹ˆ **Claude Code SDK** åˆ™æ˜¯å·¥ä¸šçº§çš„æœºå™¨äººæ‰‹è‡‚â€”â€”å®ƒå…è®¸å°† Claude çš„è‡ªä¸»ç¼–ç¨‹èƒ½åŠ›**åµŒå…¥åˆ°ä»»ä½•åº”ç”¨ç¨‹åºæˆ–å·¥ä½œæµ**ä¸­ï¼Œå®ç°çœŸæ­£çš„ç¼–ç¨‹è‡ªåŠ¨åŒ–ã€‚

æœ¬èŠ‚å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Python å’Œ TypeScript SDK æ¥æ„å»ºå®šåˆ¶åŒ–çš„ AI ç¼–ç¨‹å·¥å…·ã€‚

### 7.3.1 SDK ä¸ CLI çš„åŒºåˆ«

åœ¨æ·±å…¥ SDK ä¹‹å‰ï¼Œå…ˆå˜æ¸…å®ƒä¸ CLI çš„å…³ç³»ï¼š

| ç»´åº¦ | Claude Code CLI | Claude Code SDK |
| :--- | :--- | :--- |
| **ä½¿ç”¨æ–¹å¼** | ç»ˆç«¯äº¤äº’ï¼Œäººåœ¨å›è·¯ | ç¨‹åºåŒ–è°ƒç”¨ï¼Œå¯å…¨è‡ªåŠ¨ |
| **é€‚ç”¨åœºæ™¯** | æ—¥å¸¸å¼€å‘è¾…åŠ© | CI/CDã€IDE æ’ä»¶ã€è‡ªåŠ¨åŒ–å¹³å° |
| **è¾“å‡ºæ§åˆ¶** | å®æ—¶è¾“å‡ºåˆ°ç»ˆç«¯ | è¿”å›ç»“æ„åŒ–å¯¹è±¡ï¼Œå¯ç¼–ç¨‹å¤„ç† |
| **å¹¶å‘èƒ½åŠ›** | å•ä»»åŠ¡ | å¯å¹¶è¡Œè¿è¡Œå¤šå®ä¾‹ |

**æ ¸å¿ƒä»·å€¼**ï¼šSDK å°† Claude Code ä»"ä¸ªäººå¼€å‘åŠ©æ‰‹"å‡çº§ä¸º"å¯æ‰©å±•çš„ç¼–ç¨‹åŸºç¡€è®¾æ–½"ã€‚

### 7.3.2 å®‰è£…ä¸é…ç½®

#### Python SDK

```bash
pip install anthropic-claude-code
```

SDK ä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å– API Keyï¼š

```bash
export ANTHROPIC_API_KEY="sk-ant-..."
```

#### TypeScript/Node.js SDK

```bash
npm install @anthropic-ai/claude-code-sdk
# æˆ–
yarn add @anthropic-ai/claude-code-sdk
```

### 7.3.3 æ ¸å¿ƒ API è¯¦è§£

#### Python ç¤ºä¾‹ï¼šè‡ªåŠ¨åŒ–ä»£ç é‡æ„

```python
from anthropic_claude_code import ClaudeCode

# åˆå§‹åŒ–å®¢æˆ·ç«¯
claude = ClaudeCode(
    api_key="sk-ant-...",  # å¯é€‰ï¼Œä¹Ÿå¯ä»ç¯å¢ƒå˜é‡è¯»å–
    model="claude-4-5-sonnet-20250929"  # æŒ‡å®šæ¨¡å‹ç‰ˆæœ¬
)

# æ‰§è¡Œç¼–ç¨‹ä»»åŠ¡
result = claude.run(
    task="å°†é¡¹ç›®ä¸­æ‰€æœ‰çš„ var å£°æ˜æ”¹ä¸º const æˆ– letï¼Œå¹¶ä¿®å¤ ESLint é”™è¯¯",
    working_directory="/path/to/project",
    allowed_tools=["read_file", "write_file", "list_files", "run_command"],
    max_iterations=20,  # æœ€å¤§è¿­ä»£æ¬¡æ•°
    timeout=300  # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
)

# å¤„ç†ç»“æœ
if result.success:
    print(f"ä»»åŠ¡å®Œæˆï¼å…±ä¿®æ”¹ {len(result.modified_files)} ä¸ªæ–‡ä»¶")
    for file in result.modified_files:
        print(f"  - {file}")
else:
    print(f"ä»»åŠ¡å¤±è´¥ï¼š{result.error}")
```

#### TypeScript ç¤ºä¾‹ï¼šæ™ºèƒ½æµ‹è¯•ç”Ÿæˆ

```typescript
import { ClaudeCode, ToolPermission } from '@anthropic-ai/claude-code-sdk';

const claude = new ClaudeCode({
  model: 'claude-4-5-sonnet-20250929',
});

async function generateTests(filePath: string) {
  const result = await claude.run({
    task: `ä¸º ${filePath} ä¸­çš„æ‰€æœ‰å…¬å…±å‡½æ•°ç”Ÿæˆå•å…ƒæµ‹è¯•ï¼Œä½¿ç”¨ Jest æ¡†æ¶`,
    workingDirectory: process.cwd(),
    allowedTools: [
      ToolPermission.READ_FILE,
      ToolPermission.WRITE_FILE,
      ToolPermission.RUN_COMMAND,
    ],
    maxIterations: 15,
    onProgress: (event) => {
      // å®æ—¶ç›‘æ§è¿›åº¦
      console.log(`[${event.type}] ${event.message}`);
    },
  });

  return result;
}

// ä½¿ç”¨ç¤ºä¾‹
generateTests('./src/utils/parser.ts').then(console.log);
```

### 7.3.4 æƒé™æ§åˆ¶ï¼š`allowed_tools` è¯¦è§£

SDK çš„å®‰å…¨æ¨¡å‹åŸºäº**æ˜¾å¼æˆæƒ**ã€‚å¿…é¡»æ˜ç¡®æŒ‡å®š Claude å¯ä»¥ä½¿ç”¨å“ªäº›å·¥å…·ï¼š

| å·¥å…·å | åŠŸèƒ½ | é£é™©ç­‰çº§ |
| :--- | :--- | :--- |
| `read_file` | è¯»å–æ–‡ä»¶å†…å®¹ | ğŸŸ¢ ä½ |
| `write_file` | å†™å…¥/ä¿®æ”¹æ–‡ä»¶ | ğŸŸ¡ ä¸­ |
| `list_files` | åˆ—å‡ºç›®å½•ç»“æ„ | ğŸŸ¢ ä½ |
| `run_command` | æ‰§è¡Œç»ˆç«¯å‘½ä»¤ | ğŸ”´ é«˜ |
| `search_code` | è¯­ä¹‰æœç´¢ä»£ç åº“ | ğŸŸ¢ ä½ |

**æœ€ä½³å®è·µ**ï¼šéµå¾ª**æœ€å°æƒé™åŸåˆ™**ã€‚å¦‚æœä»»åŠ¡åªéœ€è¦è¯»å–å’Œåˆ†æä»£ç ï¼Œå°±ä¸è¦æˆäºˆ `write_file` æˆ– `run_command` æƒé™ã€‚

### 7.3.5 ä¼ä¸šçº§é›†æˆåœºæ™¯

#### åœºæ™¯ä¸€ï¼šCI/CD è‡ªåŠ¨ä»£ç å®¡æŸ¥

åœ¨ GitHub Actions ä¸­é›†æˆ Claude Codeï¼Œè‡ªåŠ¨å®¡æŸ¥æ¯ä¸ª PRï¼š

```yaml
# .github/workflows/ai-review.yml
name: AI Code Review
on: [pull_request]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Claude Review
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          pip install anthropic-claude-code
          python scripts/ai_review.py --pr ${{ github.event.pull_request.number }}
```

#### åœºæ™¯äºŒï¼šVS Code æ’ä»¶åç«¯

å°† SDK é›†æˆåˆ° IDE æ’ä»¶ä¸­ï¼Œæä¾›"ä¸€é”®ä¿®å¤"åŠŸèƒ½ï¼š

```typescript
// VS Code Extension ç¤ºä¾‹
vscode.commands.registerCommand('claude.fixIssue', async () => {
  const editor = vscode.window.activeTextEditor;
  const diagnostics = vscode.languages.getDiagnostics(editor.document.uri);
  
  const result = await claude.run({
    task: `ä¿®å¤ä»¥ä¸‹é—®é¢˜ï¼š${diagnostics.map(d => d.message).join(', ')}`,
    workingDirectory: vscode.workspace.rootPath,
    allowedTools: ['read_file', 'write_file'],
  });
  
  if (result.success) {
    vscode.window.showInformationMessage('é—®é¢˜å·²ä¿®å¤ï¼');
  }
});
```

#### åœºæ™¯ä¸‰ï¼šæ‰¹é‡ä»£ç è¿ç§»

å°†é—ç•™ä»£ç åº“ä» Python 2 è¿ç§»åˆ° Python 3ï¼š

```python
import os
from anthropic_claude_code import ClaudeCode

claude = ClaudeCode()

for root, dirs, files in os.walk("./legacy_project"):
    for file in files:
        if file.endswith(".py"):
            filepath = os.path.join(root, file)
            result = claude.run(
                task=f"å°† {filepath} ä» Python 2 è¿ç§»åˆ° Python 3ï¼Œä¿æŒåŠŸèƒ½ä¸å˜",
                working_directory="./legacy_project",
                allowed_tools=["read_file", "write_file"],
            )
            print(f"{'âœ“' if result.success else 'âœ—'} {filepath}")
```

### 7.3.6 é”™è¯¯å¤„ç†ä¸é‡è¯•

å¥å£®çš„ SDK é›†æˆéœ€è¦å¤„ç†å„ç§è¾¹ç¼˜æƒ…å†µï¼š

```python
from anthropic_claude_code import ClaudeCode, ClaudeCodeError, RateLimitError

claude = ClaudeCode()

try:
    result = claude.run(task="...", working_directory=".", allowed_tools=["read_file"])
except RateLimitError:
    print("è§¦å‘é€Ÿç‡é™åˆ¶ï¼Œè¯·ç¨åé‡è¯•")
except ClaudeCodeError as e:
    print(f"SDK é”™è¯¯ï¼š{e.message}")
```

---

æŒæ¡äº† SDKï¼Œä½ å·²ç»èƒ½å¤Ÿæ„å»ºè‡ªå·±çš„ç¼–ç¨‹è‡ªåŠ¨åŒ–å¹³å°ã€‚ä½†å¤§å¤šæ•°å¼€å‘è€…çš„æ—¥å¸¸å·¥ä½œå¹¶ä¸åœ¨å‘½ä»¤è¡Œæˆ–è„šæœ¬ä¸­ï¼Œè€Œæ˜¯åœ¨ **IDE** é‡Œã€‚

æ¥ä¸‹æ¥ï¼Œå°†å±•ç¤º Claude å¦‚ä½•åœ¨æœ€ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨ä¸­å¤§æ˜¾èº«æ‰‹ã€‚

â¡ï¸ [IDE é›†æˆä¸å·¥ä½œæµ](7.4_ide.md)
